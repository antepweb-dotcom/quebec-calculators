<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulateur Hypothèque Pro - QCFinance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .animate-slide-up { animation: slideUp 0.5s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .card-3d { 
            transform-style: preserve-3d;
            transition: transform 0.3s ease;
        }
        .card-3d:hover { transform: translateY(-8px) rotateX(2deg); }
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer { 0%, 100% { transform: translateX(-100%); } 50% { transform: translateX(100%); } }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen">

    <!-- Hero Header -->
    <header class="relative overflow-hidden py-20 px-4">
        <div class="absolute inset-0 bg-gradient-to-r from-blue-600/20 to-purple-600/20 blur-3xl"></div>
        <div class="container mx-auto max-w-6xl relative z-10">
            <div class="text-center">
                <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur-sm px-4 py-2 rounded-full mb-6">
                    <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                    <span class="text-white font-semibold">Calculateur #1 au Québec</span>
                </div>
                <h1 class="text-6xl font-black text-white mb-4">
                    Simulateur Hypothèque
                    <span class="bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent"> Intelligent</span>
                </h1>
                <p class="text-xl text-slate-300 max-w-2xl mx-auto">
                    Visualisez votre prêt en temps réel, comparez les scénarios et prenez la meilleure décision
                </p>
            </div>
        </div>
    </header>

    <!-- Main Calculator -->
    <main class="container mx-auto px-4 pb-20 max-w-7xl -mt-10">
        <div class="grid lg:grid-cols-12 gap-8">
            
            <!-- LEFT: Interactive Inputs -->
            <div class="lg:col-span-5 space-y-6">
                
                <!-- Input Card -->
                <div class="bg-white/10 backdrop-blur-xl rounded-3xl p-8 border border-white/20 card-3d">
                    <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/>
                            </svg>
                        </div>
                        Vos paramètres
                    </h2>

                    <!-- Quick Presets -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-slate-300 mb-3">Montants populaires</label>
                        <div class="grid grid-cols-4 gap-2">
                            <button onclick="setPrice(300000)" class="preset-btn px-3 py-2 bg-blue-500/20 hover:bg-blue-500 text-blue-300 hover:text-white rounded-xl font-bold text-sm transition-all border border-blue-500/30">
                                300k
                            </button>
                            <button onclick="setPrice(400000)" class="preset-btn px-3 py-2 bg-blue-500 text-white rounded-xl font-bold text-sm shadow-lg shadow-blue-500/50">
                                400k
                            </button>
                            <button onclick="setPrice(500000)" class="preset-btn px-3 py-2 bg-blue-500/20 hover:bg-blue-500 text-blue-300 hover:text-white rounded-xl font-bold text-sm transition-all border border-blue-500/30">
                                500k
                            </button>
                            <button onclick="setPrice(600000)" class="preset-btn px-3 py-2 bg-blue-500/20 hover:bg-blue-500 text-blue-300 hover:text-white rounded-xl font-bold text-sm transition-all border border-blue-500/30">
                                600k
                            </button>
                        </div>
                    </div>

                    <!-- Price Slider -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-slate-300 mb-2">Prix de la propriété</label>
                        <div class="relative mb-3">
                            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-medium">$</span>
                            <input id="priceInput" type="number" value="400000" onchange="updateCalculations()" 
                                class="w-full pl-10 pr-4 py-4 bg-white/5 border-2 border-white/10 rounded-2xl text-white text-2xl font-bold focus:border-blue-500 focus:ring-2 focus:ring-blue-500/50 transition-all">
                        </div>
                        <input id="priceSlider" type="range" min="100000" max="2000000" step="10000" value="400000" oninput="updatePrice(this.value)"
                            class="w-full h-3 bg-white/10 rounded-full appearance-none cursor-pointer accent-blue-500">
                        <div class="flex justify-between text-xs text-slate-400 mt-1">
                            <span>100k</span>
                            <span>2M</span>
                        </div>
                    </div>

                    <!-- Down Payment -->
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-2">
                            <label class="text-sm font-semibold text-slate-300">Mise de fonds</label>
                            <span id="downPaymentDisplay" class="text-lg font-bold text-blue-400">80 000$ (20%)</span>
                        </div>
                        <input id="downPaymentSlider" type="range" min="5" max="50" value="20" oninput="updateCalculations()"
                            class="w-full h-3 bg-white/10 rounded-full appearance-none cursor-pointer accent-emerald-500">
                        <div class="flex justify-between text-xs text-slate-400 mt-1">
                            <span>5%</span>
                            <span>50%</span>
                        </div>
                        <div id="cmhcWarning" class="hidden mt-3 p-3 bg-orange-500/20 border border-orange-500/30 rounded-xl">
                            <div class="flex items-start gap-2">
                                <svg class="w-5 h-5 text-orange-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                </svg>
                                <div>
                                    <p class="text-sm font-semibold text-orange-300">Assurance SCHL requise</p>
                                    <p id="cmhcAmount" class="text-xs text-orange-200 mt-1"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Interest Rate -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-slate-300 mb-2">Taux d'intérêt annuel</label>
                        <div class="relative mb-3">
                            <input id="rateInput" type="number" value="4.8" step="0.1" onchange="updateCalculations()"
                                class="w-full pl-4 pr-12 py-4 bg-white/5 border-2 border-white/10 rounded-2xl text-white text-2xl font-bold focus:border-purple-500 focus:ring-2 focus:ring-purple-500/50 transition-all">
                            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 font-medium text-xl">%</span>
                        </div>
                        <div class="grid grid-cols-4 gap-2">
                            <button onclick="setRate(4.5)" class="rate-btn px-3 py-2 bg-purple-500/20 hover:bg-purple-500 text-purple-300 hover:text-white rounded-lg text-sm font-semibold transition-all">4.5%</button>
                            <button onclick="setRate(4.8)" class="rate-btn px-3 py-2 bg-purple-500 text-white rounded-lg text-sm font-semibold shadow-lg shadow-purple-500/50">4.8%</button>
                            <button onclick="setRate(5.25)" class="rate-btn px-3 py-2 bg-purple-500/20 hover:bg-purple-500 text-purple-300 hover:text-white rounded-lg text-sm font-semibold transition-all">5.25%</button>
                            <button onclick="setRate(6.0)" class="rate-btn px-3 py-2 bg-purple-500/20 hover:bg-purple-500 text-purple-300 hover:text-white rounded-lg text-sm font-semibold transition-all">6.0%</button>
                        </div>
                    </div>

                    <!-- Amortization -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-slate-300 mb-2">Période d'amortissement</label>
                        <select id="amortizationSelect" onchange="updateCalculations()"
                            class="w-full px-4 py-4 bg-white/5 border-2 border-white/10 rounded-2xl text-white text-lg font-bold focus:border-blue-500 focus:ring-2 focus:ring-blue-500/50 transition-all">
                            <option value="15">15 ans</option>
                            <option value="20">20 ans</option>
                            <option value="25" selected>25 ans</option>
                            <option value="30">30 ans</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- RIGHT: Results Dashboard -->
            <div class="lg:col-span-7 space-y-6">
                
                <!-- Hero Payment Card -->
                <div class="gradient-bg rounded-3xl p-8 shadow-2xl card-3d relative overflow-hidden">
                    <div class="absolute inset-0 shimmer"></div>
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-4">
                            <p class="text-lg text-white/80 font-semibold">Paiement mensuel</p>
                            <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                        </div>
                        <p id="monthlyPayment" class="text-7xl font-black text-white mb-2">2 247$</p>
                        <p id="paymentDetails" class="text-white/70">Sur 25 ans à 4.8%</p>
                        
                        <div class="mt-8 pt-6 border-t border-white/20">
                            <div class="grid grid-cols-3 gap-4">
                                <div class="text-center">
                                    <p class="text-sm text-white/60 mb-1">Total payé</p>
                                    <p id="totalPaid" class="text-2xl font-bold text-white">674 100$</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-sm text-white/60 mb-1">Intérêts</p>
                                    <p id="totalInterest" class="text-2xl font-bold text-red-300">354 100$</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-sm text-white/60 mb-1">Principal</p>
                                    <p id="principal" class="text-2xl font-bold text-emerald-300">320 000$</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Biweekly Savings -->
                <div class="bg-gradient-to-br from-emerald-500/20 to-teal-500/20 backdrop-blur-xl rounded-3xl p-6 border-2 border-emerald-500/30 card-3d animate-slide-up">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-white flex items-center gap-2">
                            <svg class="w-6 h-6 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                            </svg>
                            Économisez avec paiements aux 2 semaines
                        </h3>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-4 border border-white/20">
                            <p class="text-xs text-emerald-300 font-semibold mb-1">Paiement aux 2 sem.</p>
                            <p id="biweeklyPayment" class="text-3xl font-black text-white">1 035$</p>
                        </div>
                        <div class="bg-emerald-500/30 backdrop-blur-sm rounded-2xl p-4 border border-emerald-400/50">
                            <p class="text-xs text-emerald-200 font-semibold mb-1">Économie totale</p>
                            <p id="biweeklySavings" class="text-3xl font-black text-emerald-300">48 200$</p>
                        </div>
                    </div>
                    <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-4 border border-white/20 flex items-center gap-3">
                        <svg class="w-6 h-6 text-emerald-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        <p id="biweeklyYears" class="text-sm text-white">Remboursé en <strong class="text-emerald-300">21 ans</strong> au lieu de 25 ans</p>
                    </div>
                </div>

                <!-- Chart Card -->
                <div class="bg-white/10 backdrop-blur-xl rounded-3xl p-6 border border-white/20 card-3d">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                        <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"/>
                        </svg>
                        Répartition du coût total
                    </h3>
                    <canvas id="pieChart" class="max-h-64"></canvas>
                </div>

                <!-- Timeline -->
                <div class="bg-white/10 backdrop-blur-xl rounded-3xl p-6 border border-white/20 card-3d">
                    <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                        <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Évolution du solde
                    </h3>
                    <div id="timeline" class="space-y-4"></div>
                </div>

                <!-- Actions -->
                <div class="grid grid-cols-2 gap-4">
                    <button class="flex items-center justify-center gap-2 px-6 py-4 bg-white/10 hover:bg-white/20 backdrop-blur-sm border border-white/20 text-white font-bold rounded-2xl transition-all">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
                        </svg>
                        Partager
                    </button>
                    <button class="flex items-center justify-center gap-2 px-6 py-4 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-bold rounded-2xl transition-all shadow-lg shadow-blue-500/50">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        Télécharger PDF
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
        let chart = null;

        function formatCurrency(amount) {
            return new Intl.NumberFormat('fr-CA', { style: 'currency', currency: 'CAD', maximumFractionDigits: 0 }).format(amount);
        }

        function getCMHCInsurance(price, downPayment) {
            const percent = (downPayment / price) * 100;
            const loanAmount = price - downPayment;
            if (percent >= 20) return 0;
            if (percent >= 15) return loanAmount * 0.028;
            if (percent >= 10) return loanAmount * 0.031;
            return loanAmount * 0.04;
        }

        function calculateMonthlyPayment(principal, annualRate, years) {
            const monthlyRate = annualRate / 100 / 12;
            const numberOfPayments = years * 12;
            if (monthlyRate === 0) return principal / numberOfPayments;
            return principal * (monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) / (Math.pow(1 + monthlyRate, numberOfPayments) - 1);
        }

        function updatePrice(value) {
            document.getElementById('priceInput').value = value;
            updateCalculations();
        }

        function setPrice(value) {
            document.getElementById('priceInput').value = value;
            document.getElementById('priceSlider').value = value;
            updateCalculations();
        }

        function setRate(value) {
            document.getElementById('rateInput').value = value;
            updateCalculations();
        }

        function updateCalculations() {
            const price = parseFloat(document.getElementById('priceInput').value);
            const downPaymentPercent = parseFloat(document.getElementById('downPaymentSlider').value);
            const rate = parseFloat(document.getElementById('rateInput').value);
            const amortization = parseInt(document.getElementById('amortizationSelect').value);

            const downPayment = (price * downPaymentPercent) / 100;
            const cmhcInsurance = getCMHCInsurance(price, downPayment);
            const mortgageAmount = price - downPayment + cmhcInsurance;
            const monthlyPayment = calculateMonthlyPayment(mortgageAmount, rate, amortization);
            const totalPaid = monthlyPayment * 12 * amortization;
            const totalInterest = totalPaid - mortgageAmount;

            // Update displays
            document.getElementById('downPaymentDisplay').textContent = `${formatCurrency(downPayment)} (${downPaymentPercent}%)`;
            document.getElementById('monthlyPayment').textContent = formatCurrency(monthlyPayment);
            document.getElementById('paymentDetails').textContent = `Sur ${amortization} ans à ${rate}%`;
            document.getElementById('totalPaid').textContent = formatCurrency(totalPaid);
            document.getElementById('totalInterest').textContent = formatCurrency(totalInterest);
            document.getElementById('principal').textContent = formatCurrency(mortgageAmount);

            // CMHC Warning
            if (cmhcInsurance > 0) {
                document.getElementById('cmhcWarning').classList.remove('hidden');
                document.getElementById('cmhcAmount').textContent = `Assurance: ${formatCurrency(cmhcInsurance)}`;
            } else {
                document.getElementById('cmhcWarning').classList.add('hidden');
            }

            // Biweekly
            const biweeklyPayment = monthlyPayment / 2.17;
            const biweeklyYears = Math.log(biweeklyPayment * 26 / (biweeklyPayment * 26 - (mortgageAmount * (rate / 100)))) / Math.log(1 + (rate / 100));
            const biweeklySavings = totalInterest - (biweeklyPayment * 26 * biweeklyYears - mortgageAmount);
            
            document.getElementById('biweeklyPayment').textContent = formatCurrency(biweeklyPayment);
            document.getElementById('biweeklySavings').textContent = formatCurrency(Math.max(0, biweeklySavings));
            document.getElementById('biweeklyYears').innerHTML = `Remboursé en <strong class="text-emerald-300">${Math.floor(biweeklyYears)} ans</strong> au lieu de ${amortization} ans`;

            // Update Chart
            updateChart(mortgageAmount, totalInterest);

            // Update Timeline
            updateTimeline(mortgageAmount, rate, amortization);
        }

        function updateChart(principal, interest) {
            const ctx = document.getElementById('pieChart').getContext('2d');
            
            if (chart) chart.destroy();
            
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Principal', 'Intérêts'],
                    datasets: [{
                        data: [principal, interest],
                        backgroundColor: ['#6366f1', '#ef4444'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#fff', font: { size: 14, weight: 'bold' } }
                        }
                    }
                }
            });
        }

        function updateTimeline(mortgageAmount, rate, amortization) {
            const timeline = document.getElementById('timeline');
            timeline.innerHTML = '';
            
            const milestones = [5, 10, 15, 20, 25].filter(y => y <= amortization);
            
            milestones.forEach(year => {
                const monthlyRate = rate / 100 / 12;
                const totalPayments = amortization * 12;
                const paymentsMade = year * 12;
                const paymentsRemaining = totalPayments - paymentsMade;
                
                const balance = paymentsRemaining <= 0 ? 0 : mortgageAmount * (Math.pow(1 + monthlyRate, totalPayments) - Math.pow(1 + monthlyRate, paymentsMade)) / (Math.pow(1 + monthlyRate, totalPayments) - 1);
                const percentPaid = ((mortgageAmount - balance) / mortgageAmount) * 100;
                
                const div = document.createElement('div');
                div.className = 'flex items-center gap-3';
                div.innerHTML = `
                    <span class="w-12 text-sm font-bold text-slate-300">${year} ans</span>
                    <div class="flex-1 h-3 bg-white/10 rounded-full overflow-hidden">
                        <div class="h-full ${balance === 0 ? 'bg-emerald-500' : 'bg-gradient-to-r from-blue-500 to-purple-500'} rounded-full transition-all duration-500" style="width: ${percentPaid}%"></div>
                    </div>
                    <span class="w-28 text-right text-sm font-bold ${balance === 0 ? 'text-emerald-400' : 'text-white'}">${formatCurrency(balance)}${balance === 0 ? ' ✓' : ''}</span>
                `;
                timeline.appendChild(div);
            });
        }

        // Initialize
        updateCalculations();
    </script>

</body>
</html>